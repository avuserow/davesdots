# use ctrl-q for binding
set -g prefix C-q
unbind-key C-b
bind-key q send-prefix

# Reload config
bind R 'source-file ~/.tmux.conf; display-message "reloaded"'

# Bind 'C-q C-q' to move to the last window, similar to screen.
bind C-q last-window

# Start window numbering at one.
set -g base-index 1

# 256-color mode
set -g default-terminal "screen-256color"
# TODO: xterm-256color seems to break home/end in neovim
# but screen-256color seems to break ctrl+arrows in original vim
# set -g default-terminal "xterm-256color"
# fix colors in neovim
set-option -ga terminal-overrides ",xterm-256color:Tc"

# Set status bar color scheme
set -g status-bg blue
set -g status-fg white
set -g status-left ""
set -g status-right "#[fg=white]#H"
set-window-option -g window-status-current-style bg=black

# aggressively resize to the smallest attached terminal
setw -g aggressive-resize on

# enable mouse support
set -g mouse on

# use focus-events so autoread works in vim
set -g focus-events on

# join-pane binding (opposite of C-a !)
bind @ join-pane -t -1.0

# xmonad-style emulation
set -s command-alias[100] relayout='run-shell "~/bin/tmux-layout apply"' 
set-hook -g pane-exited relayout # re-apply layout
set-hook -g client-attached relayout
bind m relayout # re-apply layout
bind j select-pane -t :.+ # mod-j
bind k select-pane -t :.- # mod-k
bind J swap-pane -D # mod-shift-j
bind K swap-pane -U # mod-shift-k
bind M 'swap-pane -t 0; select-pane -t 0' # mod-enter
bind enter 'split; relayout' # mod-shift-enter
bind \\ 'split -c "#{pane_current_path}"; relayout' # mod-shift-enter in CWD
bind s command-prompt -1 -p 'send pane to: ' 'join-pane -b -t "%%.0"; relayout'
bind + run-shell "~/bin/tmux-layout incr-mcount"
bind - run-shell "~/bin/tmux-layout decr-mcount"
bind ` last-window

set -s command-alias[101] fzf-goto-pane='tmux list-panes -s -F "#I.#P: #{pane_current_command}#{s|^ #{HOME}$||: #{pane_current_path}} -- #T" | fzf --tmux -d. --accept-nth 1 | xargs -r tmux select-window -t'
bind A fzf-goto-pane
set -s command-alias[102] fzf-bring-pane='tmux list-panes -s -F "#I.#P: #{pane_current_command}#{s|^ #{HOME}$||: #{pane_current_path}} -- #T" | fzf --tmux -d: --accept-nth 1 | xargs -r tmux join-pane -t 0.0 -s'
bind a fzf-bring-pane

# TODO:
# find pane and go to it
# find pane and bring it here
# copy/paste by clicking
# focus follows mouse? (unlikely...)

# Alt bindings
set -s user-keys[0] ""
bind -n User0 'swap-pane -t 0; select-pane -t 0' # mod-enter
set -s user-keys[1] "OM"
bind -n User1 'split; relayout'
set -s user-keys[2] "j"
bind -n User2 select-pane -t :.+ # mod-j
set -s user-keys[3] "J"
bind -n User3 swap-pane -D # mod-shift-j
set -s user-keys[4] "k"
bind -n User4 select-pane -t :.- # mod-k
set -s user-keys[5] "K"
bind -n User5 swap-pane -U # mod-shift-k
set -s user-keys[6] "[1;3D"
bind -n User6 previous-window # mod-left
set -s user-keys[7] "[1;3C"
bind -n User7 next-window # mod-right
set -s user-keys[8] "|" # mod-shift-backslash / mod-pipe
bind -n User8 'split -c "#{pane_current_path}"; relayout' # mod-shift-enter in CWD
set -s user-keys[9] "[1;4D"
bind -n User9 send-keys "mod-shift-left" # mod-shift-left
set -s user-keys[10] "[1;4C"
bind -n User10 send-keys "mod-shift-right" # mod-shift-right
set -s user-keys[11] "A"
bind User11 fzf-goto-pane
set -s user-keys[12] "a"
bind User12 fzf-bring-pane

# Meta/Super bindings, based on Konsole 25.08's bindings
# set -s user-keys[0] "@s"
# bind -n User0 'swap-pane -t 0; select-pane -t 0' # mod-enter
# set -s user-keys[1] "@sOM"
# bind -n User1 'split; relayout'
# set -s user-keys[2] "@sj"
# bind -n User2 select-pane -t :.+ # mod-j
# set -s user-keys[3] "@sJ"
# bind -n User3 swap-pane -D # mod-shift-j
# set -s user-keys[4] "@sk"
# bind -n User4 select-pane -t :.- # mod-k
# set -s user-keys[5] "@sK"
# bind -n User5 swap-pane -U # mod-shift-k
# set -s user-keys[6] "@s[D"
# bind -n User6 previous-window # mod-left
# set -s user-keys[7] "@s[C"
# bind -n User7 next-window # mod-right
# set -s user-keys[8] "@s|" # mod-shift-backslash / mod-pipe
# bind -n User8 'split -c "#{pane_current_path}"; relayout' # mod-shift-enter in CWD
